<!--users/templates/users/dashboard.html-->

{% extends 'base.html' %}

{% block content %}

Hello, {{ user.username|default:'Guest' }}!

<div>
    {% if user.is_authenticated %}
        <a href="{% url 'logout' %}">Logout</a>
		<a href="{% url 'password_change' %}">Change password</a>
		<a href="{% url 'profile_update' %}">Update profile</a>
    {% else %}
        <a href="{% url 'login' %}">Login</a>
    {% endif %}
</div>

{% if user.is_authenticated %}
    <div>
        <h3>Bio:</h3>
        {% if bio %}
            <p>{{ bio }}</p>
        {% else %}
            <p>No bio information available.</p>
        {% endif %}
    </div>

	<div>
        <h3>Chat:</h3>
        <textarea id="chat-box" cols="40" rows="10"></textarea><br>
        <input type="text" id="user-input"><button onclick="sendMessage()">Send</button>
    </div>

	<script>
        const chatSocket = new WebSocket('ws://localhost:8000/ws/chat/');

		chatSocket.onopen = function(event) {
			console.log('WebSocket connected');
		};

        chatSocket.onmessage = function(event) {
            const message = event.data;
            document.querySelector('#chat-box').value += message + '\n';
        };

        function sendMessage() {
            const userInput = document.querySelector('#user-input').value;
            chatSocket.send(JSON.stringify({
                'message': userInput
            }));
            document.querySelector('#user-input').value = '';
        }
    </script>
{% endif %}

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Get the user's chosen dashboard color from the template variable
        var userDashboardColor = "{{ user.dashboard_color }}";

        // Apply the user's chosen color as the background color of the body
        document.body.style.backgroundColor = userDashboardColor;
    });
</script>

{% endblock %}